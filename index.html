<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LittleMen Wholesale</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body>

  <!--
  <script>
    // üîê Password gate
    const pw = prompt("Enter wholesale password:");
    if (pw !== "a5#8ak_-2918$-2910%24@-351*afk_AGkg_83281$") {
      alert("Access denied");
      window.location.href = "https://google.com";
    }
  </script>
  -->

  <h1>LittleMen Wholesale Store</h1>

  <div id="cart">
    <h2>Cart</h2>
    <ul id="cart-items"></ul>
    <p id="total">Total: $0.00</p>
    <button id="checkout-btn">Checkout</button>
  </div>

  <div class="product-grid">
    <div class="product-card" data-name="LittleRobot"><img src="images/LittleRobot.jpg" alt="LittleRobot"/><h3>LittleRobot</h3><button class="add-to-cart">Add</button></div>
    <div class="product-card" data-name="LittleReptile"><img src="images/LittleReptile.jpg" alt="LittleReptile"/><h3>LittleReptile</h3><button class="add-to-cart">Add</button></div>
    <div class="product-card" data-name="LittleSkelePirate"><img src="images/LittleSkelePirate.jpg" alt="LittleSkelePirate"/><h3>LittleSkelePirate</h3><button class="add-to-cart">Add</button></div>
    <div class="product-card" data-name="LittleSkeleton"><img src="images/LittleSkeleton.jpg" alt="LittleSkeleton"/><h3>LittleSkeleton</h3><button class="add-to-cart">Add</button></div>
    <div class="product-card" data-name="LittleNinja"><img src="images/LittleNinja.jpg" alt="LittleNinja"/><h3>LittleNinja</h3><button class="add-to-cart">Add</button></div>
    <div class="product-card" data-name="LittleBoxer"><img src="images/LittleBoxer.webp" alt="LittleBoxer"/><h3>LittleBoxer</h3><button class="add-to-cart">Add</button></div>
    <div class="product-card" data-name="LittleAlien"><img src="images/LittleAlien.jpg" alt="LittleAlien"/><h3>LittleAlien</h3><button class="add-to-cart">Add</button></div>
    <div class="product-card" data-name="LittleAstronaut"><img src="images/LittleAstronaut.jpg" alt="LittleAstronaut"/><h3>LittleAstronaut</h3><button class="add-to-cart">Add</button></div>
    <div class="product-card" data-name="LittleVigilante"><img src="images/LittleVigilante.jpeg" alt="LittleVigilante"/><h3>LittleVigilante</h3><button class="add-to-cart">Add</button></div>
    <div class="product-card" data-name="LittleCrashDummy"><img src="images/LittleCrashDummy.jpg" alt="LittleCrashDummy"/><h3>LittleCrashDummy</h3><button class="add-to-cart">Add</button></div>
    <div class="product-card" data-name="LittleDuck"><img src="images/LittleDuck.jpg" alt="LittleDuck"/><h3>LittleDuck</h3><button class="add-to-cart">Add</button></div>
  </div>

  <script>
    const cart = {};
    const cartList = document.getElementById('cart-items');
    const totalEl = document.getElementById('total');
    const checkoutBtn = document.getElementById('checkout-btn');

    // Add to cart
    document.querySelectorAll('.add-to-cart').forEach(btn => {
      btn.addEventListener('click', () => {
        const name = btn.parentElement.dataset.name;
        if (!cart[name]) cart[name] = 0;
        cart[name] += 10; // adds 10 units per click
        updateCart();
      });
    });

    // Remove item
    function removeItem(name) {
      delete cart[name];
      updateCart();
    }

    // Update cart display
    function updateCart() {
      cartList.innerHTML = '';
      let totalQty = 0;
      for (const [name, qty] of Object.entries(cart)) {
        const li = document.createElement('li');
        li.innerHTML = `${name} - ${qty} units <button onclick="removeItem('${name}')">Remove</button>`;
        cartList.appendChild(li);
        totalQty += qty;
      }
      totalEl.textContent = `Total Units: ${totalQty}`;
    }

    // Checkout handler
    checkoutBtn.addEventListener('click', async () => {
      const totalQty = Object.values(cart).reduce((a, b) => a + b, 0);
      if (totalQty === 0) {
        alert("Your cart is empty!");
        return;
      }
      if (totalQty > 100) {
        alert("Weekly limit reached (100 units max)");
        return;
      }

      const items = Object.entries(cart).map(([name, quantity]) => ({ name, quantity }));

      try {
        const res = await fetch("/api/checkout", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ items }),
        });

        const data = await res.json();
        if (data.url) {
          window.location.href = data.url;
        } else {
          console.error("Checkout failed:", data);
          alert("Checkout failed.");
        }
      } catch (err) {
        console.error("Error:", err);
        alert("Checkout error. Check console.");
      }
    });
  </script>

</body>
</html>

